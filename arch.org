* 基本要求

** 关于地域分区
- 所有消息都带分区属性，为日后按地区划分客户人群做好准备
- 客户标识，手机号，通过查询归属地确认

** 关于队列持久化与大量队列影响
消息持久化不针对队列，只针对消息，在持久化之前，会存在buffer缓冲，所以队列对持久化影响不大

影响持久化的因素两点:
- publish消息时是否要求持久化
- 内存消息的消化速度

* push

队列定义:

#+BEGIN_SRC
push.<partition>
#+END_SRC

先使用两个队列来接收推送

** 估算

- 每天43w个订单，每小时18000个，每分300个，每秒5个订单
- 每个订单8个推送
- 每秒需要处理40个推送

** 总结

- 推送对队列消息量压力不大，所以无需每个client开放push队列
- 可以根据client 标识hash，分配队列，暂时保持两个，已经可以满足大规模需要
- 根据分区，和目标订单量，一个队列最大负载40个，完全满足
